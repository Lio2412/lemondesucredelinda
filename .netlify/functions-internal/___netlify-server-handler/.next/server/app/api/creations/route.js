"use strict";(()=>{var e={};e.id=5286,e.ids=[5286],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},69808:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>b,requestAsyncStorage:()=>g,routeModule:()=>x,serverHooks:()=>q,staticGenerationAsyncStorage:()=>f});var o={};t.r(o),t.d(o,{POST:()=>m});var s=t(49303),i=t(88716),a=t(60670),n=t(87070),u=t(72331),p=t(53524),l=t(31518),c=t(79843);let d="creations";async function m(e){try{let r=await e.formData(),t=r.get("title"),o=r.get("description"),s=r.get("image");if(!t)return n.NextResponse.json({error:"Le titre est requis."},{status:400});if(null==o)return n.NextResponse.json({error:"La description est requise."},{status:400});let i=null;if(s&&s.size>0){let e="https://pbqkgspugfjyrgkrciln.supabase.co",r=process.env.SUPABASE_SERVICE_ROLE;if(!e||!r)return console.error("URL Supabase ou Cl\xe9 de Service manquante dans l'environnement de l'API. Impossible d'uploader."),n.NextResponse.json({error:"Configuration serveur incompl\xe8te pour l'upload."},{status:500});let t=(0,l.eI)(e,r),o=s.name.split(".").pop(),a=`${(0,c.Z)()}.${o}`,u=`${a}`,{data:p,error:m}=await t.storage.from(d).upload(u,s);if(m)throw console.error("Erreur d'upload Supabase:",m),Error(`Erreur lors de l'upload de l'image: ${m.message}`);let{data:x}=t.storage.from(d).getPublicUrl(u);x?.publicUrl?i=x.publicUrl:(console.error("Impossible d'obtenir l'URL publique pour:",u),i=null)}let a=await u._.creation.create({data:{title:t,description:o,image:i}});return n.NextResponse.json(a)}catch(t){console.error("Erreur d\xe9taill\xe9e lors de la cr\xe9ation de la cr\xe9ation:",t);let e="Erreur serveur lors de la cr\xe9ation.",r=500;return t instanceof p.Prisma.PrismaClientKnownRequestError?"P2002"===t.code&&(e="Une cr\xe9ation avec des informations similaires existe d\xe9j\xe0.",r=409):t instanceof p.Prisma.PrismaClientValidationError?(e="Donn\xe9es invalides fournies pour la cr\xe9ation.",r=400):t instanceof Error&&(e=t.message||e),n.NextResponse.json({error:e},{status:r})}}let x=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/creations/route",pathname:"/api/creations",filename:"route",bundlePath:"app/api/creations/route"},resolvedPagePath:"C:\\Users\\Win\\Desktop\\nouveau-projet-linda\\app\\api\\creations\\route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:q}=x,v="/api/creations/route";function b(){return(0,a.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:f})}},72331:(e,r,t)=>{t.d(r,{_:()=>s});var o=t(53524);let s=global.prisma||new o.PrismaClient({})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[1633,5972,7076],()=>t(69808));module.exports=o})();