"use strict";(()=>{var e={};e.id=367,e.ids=[367],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},15069:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>j,patchFetch:()=>E,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>q,staticGenerationAsyncStorage:()=>v});var s={};t.r(s),t.d(s,{DELETE:()=>m,PUT:()=>x});var o=t(49303),n=t(88716),i=t(60670),a=t(72331),u=t(87070),l=t(31518),p=t(79843),c=t(53524);let d="creations";async function m(e,{params:r}){let t=r.id;if(!t)return u.NextResponse.json({error:"ID de cr\xe9ation manquant"},{status:400});try{return await a._.creation.delete({where:{id:t}}),console.log(`Cr\xe9ation supprim\xe9e: ${t}`),u.NextResponse.json({success:!0})}catch(e){if(console.error(`Erreur lors de la suppression de la cr\xe9ation ${t}:`,e),e instanceof Error&&"code"in e&&"P2025"===e.code)return u.NextResponse.json({error:"Cr\xe9ation non trouv\xe9e"},{status:404});return u.NextResponse.json({error:"Erreur interne du serveur"},{status:500})}}async function x(e,{params:r}){let t=r.id;if(!t)return u.NextResponse.json({error:"ID de cr\xe9ation manquant"},{status:400});let s=null,o=null,n=null,i=null,m={};try{let r="https://pbqkgspugfjyrgkrciln.supabase.co",c=process.env.SUPABASE_SERVICE_ROLE;r&&c||console.error("URL Supabase ou Cl\xe9 de Service manquante dans l'environnement de l'API.");let x=r&&c?(0,l.eI)(r,c):null,f=e.headers.get("content-type");if(f?.includes("multipart/form-data")){let r=await e.formData();s=r.get("title"),o=r.get("description"),n=r.get("image")}else{if(!f?.includes("application/json"))return u.NextResponse.json({error:"Type de contenu non support\xe9"},{status:415});let r=await e.json();s=r.title,o=r.description}if(!s)return u.NextResponse.json({error:"Le titre est requis."},{status:400});if(null==o)return u.NextResponse.json({error:"La description est requise."},{status:400});m.title=s,m.description=o;let g=null;if(n&&n.size>0){let e=await a._.creation.findUnique({where:{id:t},select:{image:!0}});if(e&&(g=e.image),!x)return console.error("Client Supabase non initialis\xe9 \xe0 cause de variables d'environnement manquantes."),u.NextResponse.json({error:"Configuration serveur incompl\xe8te pour l'upload."},{status:500});let r=n.name.split(".").pop(),s=`${(0,p.Z)()}.${r}`,o=`${s}`,{error:l}=await x.storage.from(d).upload(o,n);if(l)throw console.error("Erreur d'upload Supabase:",l),Error(`Erreur lors de l'upload de l'image: ${l.message}`);let{data:c}=x.storage.from(d).getPublicUrl(o);c?.publicUrl?(i=c.publicUrl,m.image=i):(console.error("Impossible d'obtenir l'URL publique pour:",o),i=g)}let v=await a._.creation.update({where:{id:t},data:m});if(i&&g&&i!==g)try{let e=g.split("/").pop();if(e&&x){let{error:r}=await x.storage.from(d).remove([e]);r?console.error(`Erreur lors de la suppression de l'ancienne image ${e}:`,r):console.log(`Ancienne image ${e} supprim\xe9e avec succ\xe8s.`)}}catch(e){console.error(`Erreur inattendue lors de la tentative de suppression de l'ancienne image ${g}:`,e)}return console.log(`Cr\xe9ation mise \xe0 jour: ${t}`),u.NextResponse.json(v)}catch(e){if(console.error(`Erreur lors de la mise \xe0 jour de la cr\xe9ation ${t}:`,e),e instanceof c.Prisma.PrismaClientKnownRequestError){if("P2025"===e.code)return u.NextResponse.json({error:"Cr\xe9ation non trouv\xe9e"},{status:404})}else if(e instanceof c.Prisma.PrismaClientValidationError)return u.NextResponse.json({error:"Donn\xe9es invalides fournies pour la mise \xe0 jour."},{status:400});else if(e instanceof Error)return u.NextResponse.json({error:e.message||"Erreur interne du serveur"},{status:500});return u.NextResponse.json({error:"Erreur interne du serveur"},{status:500})}}let f=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/creations/[id]/route",pathname:"/api/creations/[id]",filename:"route",bundlePath:"app/api/creations/[id]/route"},resolvedPagePath:"C:\\Users\\Win\\Desktop\\nouveau-projet-linda\\app\\api\\creations\\[id]\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:v,serverHooks:q}=f,j="/api/creations/[id]/route";function E(){return(0,i.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:v})}},72331:(e,r,t)=>{t.d(r,{_:()=>o});var s=t(53524);let o=global.prisma||new s.PrismaClient({})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1633,5972,7076],()=>t(15069));module.exports=s})();